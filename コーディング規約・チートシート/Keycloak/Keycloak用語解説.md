---
作成日: 2025-05-27
tags:
  - Keycloak
  - 認証
  - 認可
---
## 用語解説
---
### レルムとは
Keycloakにおける「レルム (Realm)」とは、**独立した認証・認可の領域**を指します。Keycloakが提供するID管理機能の中核となる概念であり、以下の要素をまとめて管理する単位となります。

- **ユーザー**: ログインするユーザーアカウント
- **クライアント**: Keycloakに認証を要求するアプリケーションやサービス（Webアプリケーション、モバイルアプリ、APIなど）
- **ロール（役割）**: ユーザーやグループに付与される権限の定義
- **グループ**: ユーザーをまとめるための概念（共通のロールや属性を一括で管理・付与）
- **認証フロー**: ユーザーがログインする際の認証方法（パスワード、多要素認証など）
- **プロトコル**: OpenID Connect、OAuth 2.0、SAML 2.0などの認証プロトコルの設定
- **テーマ**: ログインページの見た目など、UIのカスタマイズ
- **イベントログ**: 認証に関する活動履歴

#### レルムの主な役割と特徴

1. **独立した管理単位**: 各レルムは互いに分離されており、他のレルムのユーザーや設定に干渉することはありません。これにより、異なる組織やアプリケーションごとに独立したID管理環境を構築できます。例えば、企業内の部署ごとにレルムを分けたり、複数の顧客に対して異なる認証設定を提供したりする「マルチテナント」の実現に利用されます。
    
2. **マルチテナント対応**: Keycloakはレルム単位で設定を管理するため、複数のテナント（利用者グループ）に対して、それぞれ独立した認証・認可の環境を提供することが可能です。
    
3. **セキュリティと隔離**: レルムごとにユーザー、クライアント、ロールなどが厳密に管理されるため、セキュリティが強化されます。あるレルムで認証されたユーザーは、そのレルムに属するアプリケーションにのみアクセスでき、他のレルムのアプリケーションにはアクセスできません。
    
4. **設定の柔軟性**: レルムごとに認証ポリシー、パスワードポリシー、外部のIDプロバイダー（Google、GitHubなど）との連携、ユーザーフェデレーション（LDAPやActive Directoryとの連携）など、様々な設定をカスタマイズできます。
    
5. **Masterレルム**: Keycloakを初回起動した際に「Master」というデフォルトのレルムが作成されます。このMasterレルムは、Keycloak自体の管理者アカウントを管理するためのものであり、通常は他のレルムを作成・管理するために使用されます。アプリケーションの認証・認可には、Masterレルムではなく、別途作成したレルムを使用することが推奨されます。

要するに、Keycloakにおけるレルムは、**「誰が、どのような方法で、どのアプリケーションにアクセスできるか」**という認証・認可に関する全ての設定を包括的に管理する、論理的な境界線のようなものです。

---
### クライアントスコープとは
Keycloak における「クライアントスコープ」は、トークンに含める**クレーム（属性情報）や権限情報の集合**です。  
OAuth 2.0 / OpenID Connect における `scope` パラメータと密接に関係しています。

#### Keycloakのデフォルトクライアントスコープ一覧と説明

| スコープ名               | Assigned Type | プロトコル          | 説明                                                    |
| ------------------- | ------------- | -------------- | ----------------------------------------------------- |
| `acr`               | DEFAULT       | OpenID Connect | 認証コンテキスト情報（認証レベルの識別）をトークンに含める                         |
| `address`           | Optional      | OpenID Connect | ユーザーの住所情報（`street_address` など）                        |
| `basic`             | DEFAULT       | OpenID Connect | 基本的なクレーム（`sub`, `preferred_username` 等）               |
| `email`             | DEFAULT       | OpenID Connect | メールアドレスとその検証状態（`email`, `email_verified`）             |
| `microprofile-jwt`  | Optional      | OpenID Connect | MicroProfile JWT向けのスコープ（Java EEベースのアプリ用）              |
| `offline_access`    | Optional      | OpenID Connect | **リフレッシュトークン**を取得するために必須                              |
| `organization`      | Optional      | OpenID Connect | 組織に関するクレーム（用途不明瞭、Keycloakで未使用のことも多い）                  |
| `phone`             | Optional      | OpenID Connect | 電話番号関連のクレーム（`phone_number`, `phone_verified`）         |
| `profile`           | DEFAULT       | OpenID Connect | ユーザーの基本プロフィール（`name`, `family_name`, `given_name` など） |
| `role_list`         | DEFAULT       | SAML           | SAMLプロトコル向けのロール一覧スコープ                                 |
| `roles`             | DEFAULT       | OpenID Connect | **アクセストークンにユーザーのロール情報を含めるためのスコープ**                    |
| `saml_organization` | DEFAULT       | SAML           | SAML向けの組織情報スコープ（通常未使用）                                |
| `service_account`   | None          | OpenID Connect | サービスアカウント専用のスコープ                                      |
| `web-origins`       | DEFAULT       | OpenID Connect | 許可されたCORSのオリジン（`allowed_origins`）をトークンに含める            |

※ `offline_access` を有効にしていないと、リフレッシュトークンがトークンレスポンスに含まれません。

---

